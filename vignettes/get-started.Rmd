---
title: "Get-Started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Get-Started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(Rmatch)
```

<!-- This vignette is generated by fusen: do not edit by hand -->

<!-- Run this 'development' chunk -->
<!-- Store every call to library() that you need to explore your functions -->


<!--
 You need to run the 'description' chunk in the '0-dev_history.Rmd' file before continuing your code there.

If it is the first time you use {fusen}, after 'description', you can directly run the last chunk of the present file with inflate() inside.
--> 


# Datasets

# Functions

## standardize_str

  

```{r example-standardize_str, eval = FALSE}
standardize_str(c("jkldsa   jkdhas   Ã¤Ã¤Ã¤  Â§$ ## #'''"))
```

  

  


## standardize_data

    

  

```{r example-standardize_data, eval = FALSE}
standardize_data(source, c("name", "iso3", "city", "address"))
```

  

  

## extract_legal_form

  

```{r example-extract_legal_form, eval = FALSE}
extract_legal_form(source, "name")
```

  

## match_col

  
  

## match_data

    

  

```{r example-match_data, eval = FALSE}
library(Rmatch)
match_data(source[1:100, ], target[1:1000, ], c("name", "city"), .min_sim = 0)
```

## uniqueness_vec

  

```{r example-uniqueness_vec, eval = FALSE}
uniqueness_vec(source[["name"]][1:10])
```

  

  

## uniqueness_data

  

```{r example-uniqueness_data, eval = FALSE}
uniqueness_data(source, c("name", "iso3", "city", "address"), "source")
```

  

  
  

## scores_data

  

   


# Workflow

## Defining Variables

```{r}
tab_source0 <- source
tab_target0 <- target
tab_matches <- matches
```

```{r}
tab_source1 <- extract_legal_form(tab_source0, "name")
tab_target1 <- extract_legal_form(tab_target0, "name")
```

```{r}
cols <- c("name", "iso3", "city", "address")
tab_match1 <- match_data(tab_source0, tab_target0, cols, 5, .2, "osa")
tab_match2 <- match_data(tab_source0, tab_target0, cols, 10, .2, "osa")

cols <- c("name", "iso3")
tab_match3 <- match_data(tab_source0, tab_target0, cols, 5, .2, "osa")
tab_match4 <- match_data(tab_source0, tab_target0, cols, 10, .2, "osa")

cols <- c("name_adj", "legal_form", "iso3", "city", "address")
tab_match5 <- match_data(tab_source1, tab_target1, cols, 5, .2, "osa")
tab_match6 <- match_data(tab_source1, tab_target1, cols, 10, .2, "osa")

cols <- c("name_adj", "legal_form", "iso3")
tab_match7 <- match_data(tab_source1, tab_target1, cols, 5, .2, "osa")
tab_match8 <- match_data(tab_source1, tab_target1, cols, 10, .2, "osa")
```

```{r}
tab_score1 <- scores_data(tab_match1, "sim2")
tab_score2 <- scores_data(tab_match2, "sim2")

tab_score3 <- scores_data(tab_match3, "sim2")
tab_score4 <- scores_data(tab_match4, "sim2")

tab_score5 <- scores_data(tab_match5, "sim3")
tab_score6 <- scores_data(tab_match6, "sim3")

tab_score7 <- scores_data(tab_match7, "sim3")
tab_score8 <- scores_data(tab_match8, "sim3")
```

```{r}
get_accuracy <- function(.score, .matches) {
  .score %>%
    select(id_s, id_t, starts_with("mean_sim")) %>%
    pivot_longer(starts_with("mean_sim")) %>%
    arrange(name, desc(value)) %>%
    filter(!duplicated(paste0(name, id_t))) %>%
    distinct(id_s, name, .keep_all = TRUE) %>%
    filter(value > 0) %>%
    inner_join(.matches, by = c("id_s", "id_t")) %>%
    group_by(name) %>%
    summarise(
      p = n() / nrow(.matches)
    )
}

tab1 <- tab_source0 %>%
  inner_join(tab_target0, by = c("name", "iso3")) %>%
  distinct(id.x, .keep_all = TRUE) %>%
  distinct(id.y, .keep_all = TRUE) %>%
  summarise(
   p = n() / nrow(tab_matches)
  ) %>% mutate(type = "No LF - Benchmark")

tab2 <- tab_source1 %>%
  inner_join(tab_target1, by = c("name_adj", "legal_form", "iso3")) %>%
  distinct(id.x, .keep_all = TRUE) %>%
  distinct(id.y, .keep_all = TRUE) %>%
  summarise(
   p = n() / nrow(tab_matches)
  ) %>% mutate(type = "LF - Benchmark")

bind_rows(
  mutate(get_accuracy(tab_score1, tab_matches), type = "No LF - 5 Matches - Cols: All"),
  mutate(get_accuracy(tab_score2, tab_matches), type = "No LF - 10 Matches - Cols: All"),
  
  mutate(get_accuracy(tab_score3, tab_matches), type = "No LF - 5 Matches - Cols: name, iso3"),
  mutate(get_accuracy(tab_score4, tab_matches), type = "No LF - 10 Matches - Cols: name, iso3"),
  
  mutate(get_accuracy(tab_score5, tab_matches), type = "LF - 5 Matches - Cols: All"),
  mutate(get_accuracy(tab_score6, tab_matches), type = "LF - 10 Matches - Cols: All"),
  
  mutate(get_accuracy(tab_score7, tab_matches), type = "LF - 5 Matches - Cols: name_adj, legal_form, iso3"),
  mutate(get_accuracy(tab_score8, tab_matches), type = "LF - 10 Matches - Cols: name_adj, legal_form, iso3"),
  tab1,
  tab2
) %>%
  select(type, everything()) %>%
  pivot_wider(names_from = name, values_from = p)
```

# Inflate your package

You're one inflate from paper to box.
Build your package from this very Rmd using `fusen::inflate()`

- Verify your `"DESCRIPTION"` file has been updated
- Verify your function is in `"R/"` directory
- Verify your test is in `"tests/testthat/"` directory
- Verify this Rmd appears in `"vignettes/"` directory

